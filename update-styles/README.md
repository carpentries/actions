# Update Carpentries Lesson to the latest version of styles

This action will fetch the changes upstream of a `styles`-format lesson and merges them into the gh-pages or PR branch of your repository. 
This can be combined with integration tests or other actions that create pull requests on your behalf. 

# Usage

Inputs available:

- `commit` : A boolean field that indicates if a commit should be created after merge. If `true`, a commit will be created, if `false`, the merge will remain uncommited and a downstream action will need to perform that task.

## Environment Variables

For simplicity, environment variables are used to pass in user parameters.
These parameters are:

- `PR` : the pull request number, if any
- `LESSON` : the human-readable name of the lesson
- `REF` : the branch reference to use, e.g. `${{ github.ref }}`. If unset, it will default to `gh-pages`

## Outputs

- `update` : If there were changes, this value will be `true`, otherwise, it will be empty

## Example

This example is truncated from the update-styles action proposed in the lesson-
example repository. Note that because this action creates a pull request, it 
should only ever use `workflow_dispatch` and `schedule`. Here, you can see us
setting the `LESSON` environment variable and the `REF` environment variable.

```yaml
name: Weekly Styles Update
on:
  workflow_dispatch: ...
  schedule: ...

jobs:
  update-styles:
    runs-on: ubuntu-20.04
    name: Styles Update
    steps:
      - uses: actions/checkout@v2

      - name: Sync lesson with carpentries/styles
        id: update
        uses: carpentries/actions/update-styles@main
        env:
          REF: ${{ github.ref }}
          LESSON: "Lesson Example"
        with:
          commit: true

      - name: Create Pull Request
        id: cpr
        if: ${{ steps.update.outputs.update == 'true' }}
        uses: peter-evans/create-pull-request@v4
        with:
          token: ${{ secrets.STYLES_WORKFLOW }}
          commit-message: "[actions] Sync lesson with carpentries/styles"
          branch: "update-styles"
          delete-branch: true
          title: "Update Styles ..."
          body: |
            Update styles repository
            - Auto-generated by [create-pull-request][1]

            [1]: https://github.com/peter-evans/create-pull-request
          labels: "type:template and tools"
          team-reviewers: core-team-curriculum
          draft: false
```

## Justification

This action attempts to remove the pain of updating the `styles` repository for
Carpentries lessons developed before {sandpaper}.

This type of lessons were created directly from the [styles template], which
invloved importing the repository from The Carpentries GitHub account to a new
repository (note, not the same as templating or forking).

Importing means that all of the styles and tools lived inside the "copied" repository.
As such, as time went on, the lesson would rapidly fall out of date from the 
styles repository. The process for updating it always required the maintainer 
to pull changes from the styles repository and merge them.

This action consists of a `bash` script developed by Maxim Belkin that was
originally meant to perform [integration tests on the styles repository][orig].

[styles template]: https://carpentries.github.io/lesson-template
[orig]: https://github.com/carpentries/styles/commit/d3f553d205fd7dfb71998f2ac6f4072e072ebeda#diff-8c756d76291b39cc76303be35bb3a526eae9d0b37c60fa60b1f444db109f7bab
